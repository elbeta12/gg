<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pimpom 2 Jugadores</title>
  <style>
    :root{
      --bg:#0f1724;
      --court:#0b1220;
      --line:#1f8fff;
      --accent:#ffd166;
      --text:#e6eef8;
      --glass: rgba(255,255,255,0.04);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:Inter, Roboto, system-ui, -apple-system, "Segoe UI", "Helvetica Neue", Arial;
      background: linear-gradient(180deg,var(--bg),#06101a 120%);
      color:var(--text);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:20px;
    }
    .wrap{
      width:1120px;
      max-width:98vw;
      background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:12px;
      padding:18px;
      box-shadow: 0 6px 24px rgba(2,6,23,0.6);
      display:grid;
      grid-template-columns: 1fr 340px;
      gap:14px;
      align-items:start;
    }
    .game-box{background:var(--court); border-radius:8px; padding:10px; display:flex;flex-direction:column; gap:8px}
    canvas{display:block; width:100%; height:720px; border-radius:6px; background: linear-gradient(180deg,#071226, #061322); box-shadow: inset 0 0 0 2px rgba(255,255,255,0.02)}
    .hud{display:flex; align-items:center; justify-content:space-between; gap:8px}
    .scores{display:flex; gap:18px; align-items:center}
    .score{background:var(--glass); padding:8px 14px; border-radius:10px; min-width:92px; text-align:center}
    .score h2{margin:0;font-size:20px}
    .score p{margin:0;color:#9fb7d9;font-size:12px}
    .panel{padding:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.008)); border-radius:10px}
    .panel h3{margin-top:0}
    .controls{display:grid; gap:8px}
    .controls button{background:transparent;border:1px solid rgba(255,255,255,0.06); padding:8px 10px;border-radius:8px;color:var(--text); cursor:pointer}
    .small{font-size:13px;color:#9fb7d9}
    .kbd{display:inline-block;padding:4px 8px;border-radius:6px;background:#071a2b;border:1px solid rgba(255,255,255,0.03);font-weight:600}
    footer{font-size:12px;color:#9fb7d9;margin-top:10px}
    .big{font-size:18px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="game-box">
      <div class="hud">
        <div class="scores">
          <div class="score">
            <h2 id="scoreLeft">0</h2>
            <p>Jugador Izq (W/S)</p>
          </div>
          <div class="score">
            <h2 id="scoreRight">0</h2>
            <p>Jugador Der (↑/↓)</p>
          </div>
        </div>
        <div>
          <div class="small">Presiona <span class="kbd">Space</span> para pausar • <span class="kbd">R</span> reiniciar</div>
        </div>
      </div>
      <canvas id="game" width="1120" height="720"></canvas>
      <footer>Primera a 11 puntos · Gana por 2</footer>
    </div>

    <aside class="panel">
      <h3>Controles & Opciones</h3>
      <div class="controls">
        <div class="small">Izquierda: <span class="kbd">W</span> / <span class="kbd">S</span></div>
        <div class="small">Derecha: <span class="kbd">↑</span> / <span class="kbd">↓</span></div>
        <button id="btnStart">Iniciar / Reanudar</button>
        <button id="btnPause">Pausar</button>
        <button id="btnReset">Reiniciar juego</button>
        <label class="small">Velocidad de la bola</label>
        <input id="ballSpeed" type="range" min="2" max="10" value="5">
        <label class="small">Tamaño de paletas</label>
        <input id="paddleSize" type="range" min="100" max="260" value="180">
      </div>
    </aside>
  </div>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
let W = canvas.width, H = canvas.height;

let running = false;
let paused = false;
let scoreLeft = 0, scoreRight = 0;
const winPoints = 11;

let paddle = { w: 16, h: 180, speed: 6 };
let left = { x: 32, y: H/2 - paddle.h/2 };
let right = { x: W - 32 - paddle.w, y: H/2 - paddle.h/2 };

let ball = { x: W/2, y: H/2, r: 10, vx: 5, vy: 2 };
let serveTo = Math.random() < 0.5 ? 'left' : 'right';

const scoreLeftEl = document.getElementById('scoreLeft');
const scoreRightEl = document.getElementById('scoreRight');
const ballSpeedEl = document.getElementById('ballSpeed');
const paddleSizeEl = document.getElementById('paddleSize');

const keys = {};
window.addEventListener('keydown', e=>{ keys[e.key.toLowerCase()] = true; if(['ArrowUp','ArrowDown',' '].includes(e.key)) e.preventDefault(); });
window.addEventListener('keyup', e=>{ keys[e.key?.toLowerCase()] = false });

document.getElementById('btnStart').addEventListener('click', ()=>{ start(); });
document.getElementById('btnPause').addEventListener('click', ()=>{ togglePause(); });
document.getElementById('btnReset').addEventListener('click', resetGame);
ballSpeedEl.addEventListener('input', ()=>{ ball.vx = Math.sign(ball.vx) * Number(ballSpeedEl.value); });
paddleSizeEl.addEventListener('input', ()=>{ paddle.h = Number(paddleSizeEl.value); clampPaddles(); });

function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); }
function clampPaddles(){ left.y = clamp(left.y, 0, H - paddle.h); right.y = clamp(right.y, 0, H - paddle.h); }

function serve(side){ ball.x = W/2; ball.y = H/2; const speed = Number(ballSpeedEl.value) || 5; const angle = (Math.random() * Math.PI/3) - Math.PI/6; ball.vx = (side==='left' ? -1 : 1) * speed * Math.cos(angle); ball.vy = speed * Math.sin(angle); serveTo = side; }

function resetGame(){ scoreLeft=0; scoreRight=0; updateScore(); serve(Math.random()<0.5?'left':'right'); }
function start(){ if(!running){ running = true; paused = false; loop(); } else { paused = false; } }
function togglePause(){ paused = !paused; }
function updateScore(){ scoreLeftEl.textContent = scoreLeft; scoreRightEl.textContent = scoreRight; }

function step(){
  if(keys['w']) left.y -= paddle.speed; if(keys['s']) left.y += paddle.speed;
  if(keys['arrowup']) right.y -= paddle.speed; if(keys['arrowdown']) right.y += paddle.speed;
  if(keys[' ']){ keys[' ']=false; togglePause(); }
  if(keys['r']){ keys['r']=false; resetGame(); }
  clampPaddles();

  ball.x += ball.vx; ball.y += ball.vy;

  if(ball.y - ball.r < 0){ ball.y = ball.r; ball.vy *= -1; }
  if(ball.y + ball.r > H){ ball.y = H - ball.r; ball.vy *= -1; }

  if(ball.x - ball.r < left.x + paddle.w && ball.x - ball.r > left.x){
    if(ball.y > left.y && ball.y < left.y + paddle.h){ ball.x = left.x + paddle.w + ball.r; reflectFromPaddle(left); }
  }
  if(ball.x + ball.r > right.x && ball.x + ball.r < right.x + paddle.w){
    if(ball.y > right.y && ball.y < right.y + paddle.h){ ball.x = right.x - ball.r; reflectFromPaddle(right); }
  }

  if(ball.x < 0){ scoreRight++; updateScore(); serve('right'); }
  if(ball.x > W){ scoreLeft++; updateScore(); serve('left'); }
}

function reflectFromPaddle(p){
  const relative = ((ball.y - (p.y + paddle.h/2)) / (paddle.h/2));
  const maxBounce = Math.PI/3;
  const angle = relative * maxBounce;
  const speed = Math.min(12, Math.hypot(ball.vx, ball.vy) * 1.04 + 0.2);
  const dir = (p===left) ? 1 : -1;
  ball.vx = dir * speed * Math.cos(angle);
  ball.vy = speed * Math.sin(angle);
}

function drawCourt(){ ctx.clearRect(0,0,W,H); ctx.fillStyle = '#02101a'; ctx.fillRect(0,0,W,H); ctx.strokeStyle = 'rgba(255,255,255,0.06)'; ctx.lineWidth = 2; ctx.setLineDash([12,10]); ctx.beginPath(); ctx.moveTo(W/2,30); ctx.lineTo(W/2,H-30); ctx.stroke(); ctx.setLineDash([]); }

function draw(){ drawCourt(); ctx.fillStyle = '#cbe6ff'; ctx.fillRect(left.x, left.y, paddle.w, paddle.h); ctx.fillStyle = '#ffd166'; ctx.fillRect(right.x, right.y, paddle.w, paddle.h); ctx.fillStyle = '#5aa2ff'; ctx.beginPath(); ctx.arc(ball.x, ball.y, ball.r, 0, Math.PI*2); ctx.fill(); }

let last=0;
function loop(ts){ if(!running) return; if(paused){ requestAnimationFrame(loop); return; } if(!last) last=ts; const delta = ts - last; last = ts; const steps = Math.max(1, Math.floor(delta/16)); for(let i=0;i<steps;i++){ step(); } draw(); requestAnimationFrame(loop); }

function init(){ paddle.h = Number(paddleSizeEl.value); ball.vx = Number(ballSpeedEl.value) * (serveTo==='left' ? -1 : 1); ball.vy = (Math.random()*2-1)*2; updateScore(); draw(); }

init();
start();
</script>
</body>
</html>
